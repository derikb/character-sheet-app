<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <title>Character Sheet. 5e.</title>
        <meta name="application-name" content="Character Sheet. 5e.">
        <meta name="description" content="Online character sheet for 5e D&amp;D.">

        <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
        <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="./manifest.json">
        <link rel="mask-icon" href="./safari-pinned-tab.svg" color="#5bbad5">
        <meta name="apple-mobile-web-app-title" content="CharSheet5e">
        <meta name="theme-color" content="#ffffff">
        <meta name="msapplication-config" content="./browserconfig.xml" />

        <link rel="stylesheet" href="./styles.css">
    </head>
    <body>
        <div class="alertContainer">
            <div class="alert alert-unsaved" hidden>Unsaved changes... <button type="button" class="btn-save btn-sm">Save</button></div>
            <div class="alert alert-delete" hidden>
                <span>Deleting character... <button type="button" class="btn-delete-undo btn-sm" data-key="">Undo</button></span>
                <span class="delete-timeout"></span>
            </div>
        </div>
        <modal-mib id="alert-main"  hidden></modal-mib>
        <modal-mib id="dialog-load" hidden></modal-mib>
        <modal-mib id="dialog-backup" hidden></modal-mib>
        <modal-mib id="dialog-restore" hidden></modal-mib>
        <modal-mib id="dialog-delete" hidden></modal-mib>
        <modal-mib id="dialog-auth" hidden></modal-mib>
        <modal-mib id="dialog-sync" hidden></modal-mib>

        <div class="container">
            <div class="app-actions" role="toolbar" aria-label="Character Actions">
                <button type="button" class="btn-save" data-action="save" tabindex="0">Save</button>
                <button type="button" class="btn-load btn-dialog" data-action="load" tabindex="-1">Load</button>
                <confirm-button class="btn btn-new-character" data-action="new" tabindex="-1">
                    <span slot="default">New</span>
                </confirm-button>
                <button type="button" class="btn-backup btn-dialog" data-action="backup" tabindex="-1">Backup</button>
                <button type="button" class="btn-restore-backup btn-dialog" data-action="restore" tabindex="-1">Restore</button>
                <button type="button" class="btn-delete btn-dialog" data-action="delete" tabindex="-1">Delete</button>
                <button type="button" class="btn-auth btn-dialog hidden" data-action="auth" tabindex="-1">Login</button>
            </div>

            <main>
                <header id="page-top" class="page-header">
                    <h1 class="pc-charname" aria-label="Character Name"><field-editable data-name="charname" placeholder="Character Name"></field-editable></h1>
                    <div class="menu-open">
                        <button type="button" class="btn-open-actions">Menu</button>
                    </div>
                </header>

                <ul id="toptabs" role="tablist">
                    <li role="presentation"><a role="tab" id="tab-stats" href="#pane-stats" aria-selected="true">Statistics, Abilities, Equipment, etc.</a></li>
                    <li role="presentation"><a role="tab" id="tab-notes" href="#pane-notes" aria-selected="false">Notes, Personality, NPCs, etc.</a></li>
                </ul>

                <section id="pane-stats" class="grid" role="tabpanel" aria-labelledby="tab-stats">
                    <section class="fullwidth">
                        <dl class="field">
                            <div>
                                <dt>Class</dt><dd><field-editable data-name="charclass"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Race</dt><dd><field-editable data-name="race"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Background</dt><dd><field-editable data-name="background"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Alignment</dt><dd><field-editable data-name="alignment"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Level</dt><dd><field-editable data-name="level" class="small"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Experience</dt><dd><field-editable data-name="experience" class="small"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Proficiency Bonus</dt><dd class="small" data-name="proficiency"></dd>
                            </div>
                            <div>
                                <dt>Inspiration</dt><dd><field-editable data-name="inspiration" class="small"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Speed</dt><dd><field-editable data-name="speed" class="small"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Hit Dice</dt>
                                <dd>
                                    <field-editable class="smallinline" data-name="hd_cur" placeholder="0" aria-label="Current Hit Dice"></field-editable> <strong>/</strong> <field-editable class="smallinline" data-name="hd_max" placeholder="0" aria-label="Maximum Hit Dice"></field-editable>
                                </dd>
                            </div>
                            <div class="with_icon">
                                <dt>Armor Class</dt><dd><field-editable data-name="armor_class" placeholder="10" class="small"></field-editable></dd>
                            </div>
                            <div class="with_icon">
                                <dt>Hit Points</dt>
                                <dd>
                                    <field-editable class="smallinline" data-name="hp_cur" placeholder="0" aria-label="Current Hit Points"></field-editable> <strong>/</strong> <field-editable class="smallinline" data-name="hp_max" placeholder="0" aria-label="Maximum Hit Points"></field-editable>
                                </dd>
                            </div>
                            <div>
                                <dt>Death Save Success/Fail</dt>
                                <dd>
                                    <input type="number" class="small" name="death_success" data-name="deathSave" data-subfield="success" value="0" min="0" max="3" aria-label="Death Save Successes" />
                                    <strong>/</strong>
                                    <input type="number" class="small" name="death_fail" data-name="deathSave" data-subfield="fail" value="0" min="0" max="3" aria-label="Death Save Fails" />
                                </dd>
                            </div>
                            <div class="with_icon">
                                <dt>Class Points</dt>
                                <dd>
                                    <input type="number" class="small" data-name="class_points" data-subfield="cur" placeholder="0" min="0" aria-label="Current Class Points"/> <strong>/</strong> <input type="number" class="small" data-name="class_points" data-subfield="max" placeholder="0" min="0" aria-label="Maximum Class Points" />
                                </dd>
                            </div>
                        </dl>
                    </section>

                    <section>
                        <h2 id="page-attributes">Attributes</h2>
                        <section class="pc-attributes" aria-labelledby="page-attributes" role="list">
                            <attr-listing data-name="str">Str</attr-listing>
                            <attr-listing data-name="dex">Dex</attr-listing>
                            <attr-listing data-name="con">Con</attr-listing>
                            <attr-listing data-name="intel">Int</attr-listing>
                            <attr-listing data-name="wis">Wis</attr-listing>
                            <attr-listing data-name="cha">Cha</attr-listing>
                        </section>

                        <h2 id="page-skills">Skills</h2>
                        <section class="pc-skills" aria-labelledby="ppage-skills" role="list">
                            <skill-listing data-name="skills" data-subfield="acrobatics">Acrobatics (Dex)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="animal_handling">Animal Handling (Wis)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="arcana">Arcana (Int)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="athletics">Athletics (Str)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="deception">Deception (Cha)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="history">History (Int)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="insight">Insight (Wis)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="intimidation">Intimidation (Cha)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="investigation">Investigation (Int)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="medicine">Medicine (Wis)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="nature">Nature (Int)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="perception">Perception (Wis)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="performance">Performance (Cha)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="persuasion">Persuasion (Cha)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="religion">Religion (Int)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="sleight_of_hand">Sleight of Hand (Dex)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="stealth">Stealth (Dex)</skill-listing>
                            <skill-listing data-name="skills" data-subfield="survival">Survival (Wis)</skill-listing>
                        </section>
                    </section>

                    <section class="grid-span-col-2">
                        <h2>Weapons & Attacks</h2>
                        <table-editable columns="Name||Attack||Damage||Notes" data-name="weapons"></table-editable>

                        <h2>Features & Traits</h2>
                        <simple-list data-name="features"></simple-list>

                        <h2>Other Proficiencies</h2>
                        <field-editable class="largearea" data-name="proficiencies_other"></field-editable>

                        <h2>Equipment</h2>
                        <simple-list data-name="equipment"></simple-list>

                        <dl class="field">
                            <div>
                                <dt>CP</dt><dd><field-editable data-name="cp" placeholder="0" class="small"></field-editable></dd>
                                <dt>SP</dt><dd><field-editable data-name="sp" placeholder="0" class="small"></field-editable></dd>
                            </div>
                            <div>
                                <dt>GP</dt><dd><field-editable data-name="gp" placeholder="0" class="small"></field-editable></dd>
                                <dt>PP</dt><dd><field-editable data-name="pp" placeholder="0" class="small"></field-editable></dd>
                            </div>
                        </dl>
                    </section>

                    <section class="fullwidth">
                        <h2 id="page-spells">Spells</h2>

                        <dl class="field">
                            <div>
                                <dt>Spell Ability</dt><dd><field-editable data-name="spell_ability"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Spell Save DC</dt><dd><field-editable data-name="spell_save"></field-editable></dd>
                            </div>
                            <div>
                                <dt>Spell Attack Bonus</dt><dd><field-editable data-name="spell_attack"></field-editable></dd>
                            </div>
                        </dl>

                    <h3>Spell Slots</h3>

                    <dl class="field">
                        <div>
                            <dt>1st</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="1" aria-label="Current spell slots: Level 1" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="1" aria-label="Max spell slots: Level 1" min="0" value="0" />
                            </dd>
                            <dt>2nd</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="2" aria-label="Current spell slots: Level 2" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="2" aria-label="Max spell slots: Level 2" min="0" value="0" />
                            </dd>
                        </div>
                        <div>
                            <dt>3rd</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="3" aria-label="Current spell slots: Level 3" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="3" aria-label="Max spell slots: Level 3" min="0" value="0" />
                            </dd>
                            <dt>4th</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="4" aria-label="Current spell slots: Level 4" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="4" aria-label="Max spell slots: Level 4" min="0" value="0" />
                            </dd>
                        </div>
                        <div>
                            <dt>5th</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="5" aria-label="Current spell slots: Level 5" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="5" aria-label="Max spell slots: Level 5" min="0" value="0" />
                            </dd>
                            <dt>6th</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="6" aria-label="Current spell slots: Level 6" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="6" aria-label="Max spell slots: Level 6" min="0" value="0" />
                            </dd>
                        </div>
                        <div>
                            <dt>7th</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="7" aria-label="Current spell slots: Level 7" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="7" aria-label="Max spell slots: Level 7" min="0" value="0" />
                            </dd>
                            <dt>8th</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="8" aria-label="Current spell slots: Level 8" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="8" aria-label="Max spell slots: Level 8" min="0" value="0" />
                            </dd>
                        </div>
                        <div>
                            <dt>9th</dt>
                            <dd>
                                <input type="number" class="small" data-name="spell_slots_cur" data-subfield="9" aria-label="Current spell slots: Level 9" min="0" />
                                <strong>/</strong>
                                <input type="number" class="small" data-name="spell_slots" data-subfield="9" aria-label="Max spell slots: Level 9" min="0" value="0" />
                            </dd>
                        </div>
                    </dl>
                </section>

                    <section>
                        <h3>Cantrips</h3>
                        <simple-list data-name="spells" data-subfield="0"></simple-list>
                    </section>
                    <section hidden>
                        <h3>1st</h3>
                        <simple-list data-name="spells" data-subfield="1"></simple-list>
                    </section>
                    <section hidden>
                        <h3>2nd</h3>
                        <simple-list data-name="spells" data-subfield="2"></simple-list>
                    </section>
                    <section hidden>
                        <h3>3rd</h3>
                        <simple-list data-name="spells" data-subfield="3"></simple-list>
                    </section>
                    <section hidden>
                        <h3>4th</h3>
                        <simple-list data-name="spells" data-subfield="4"></simple-list>
                    </section>
                    <section hidden>
                        <h3>5th</h3>
                        <simple-list data-name="spells" data-subfield="5"></simple-list>
                    </section>
                    <section hidden>
                        <h3>6th</h3>
                        <simple-list data-name="spells" data-subfield="6"></simple-list>
                    </section>
                    <section hidden>
                        <h3>7th</h3>
                        <simple-list data-name="spells" data-subfield="7"></simple-list>
                    </section>
                    <section hidden>
                        <h3>8th</h3>
                        <simple-list data-name="spells" data-subfield="8"></simple-list>
                    </section>
                    <section hidden>
                        <h3>9th</h3>
                        <simple-list data-name="spells" data-subfield="9"></simple-list>
                    </section>
                </section>

                <section id="pane-notes" role="tabpanel" aria-labelledby="tab-notes" hidden class="grid">
                    <section>
                        <h2>NPCs</h2>
                        <note-list data-name="npcs"></note-list>
                    </section>
                    <section>
                        <h2>Factions</h2>
                        <note-list data-name="factions"></note-list>
                    </section>
                    <section>
                        <h2>Party Members</h2>
                        <note-list data-name="partymembers"></note-list>
                    </section>

                    <section>
                        <h2>Personality</h2>
                        <h3>Traits</h3>
                        <field-editable class="smallarea" data-name="traits"></field-editable>
                        <h3>Ideals</h3>
                        <field-editable class="smallarea" data-name="ideals"></field-editable>
                        <h3>Bonds</h3>
                        <field-editable class="smallarea" data-name="bonds"></field-editable>
                        <h3>Flaws</h3>
                        <field-editable class="smallarea" data-name="flaws"></field-editable>
                        <h3>Appearance</h3>
                        <field-editable class="smallarea" data-name="appearance"></field-editable>
                        <h2>Languages</h2>
                        <field-editable class="smallarea" data-name="languages"></field-editable>
                    </section>

                    <section>
                        <h2 id="page-notes_adv">Adventure Notes</h2>
                        <note-list data-name="notes_adv"></note-list>
                    </section>
                    <section>
                        <h2>Campaign Notes</h2>
                        <note-list data-name="notes_cam"></note-list>
                    </section>

                    <section>
                        <h2>Character Notes</h2>
                        <field-editable class="largearea" data-name="notes"></field-editable>
                    </section>
                </section>
            </main>
            <footer>
                <h4>Character Sheet. 5e.</h4>
                <ul>
                    <li><button type="button" class="btn-plain btn-help btn-dialog">Help</button></li>
                    <li>Created by <a href="https://derikbadman.com">Derik A Badman</a></li>
                    <li><a href="https://github.com/derikb/character-sheet-5e">Github</a></li>
                </ul>
            </footer>
            <nav>
                <ol>
                    <li><a href="#page-top">Top</a></li>
                    <li><a data-tab="pane-stats" href="#page-attributes">Attributes</a></li>
                    <li><a data-tab="pane-stats" href="#page-skills">Skills</a></li>
                    <li><a data-tab="pane-stats" href="#page-spells">Spells</a></li>
                    <li><a data-tab="pane-notes" href="#page-notes_adv">Notes</a></li>
                </ol>
            </nav>
        </div>

        <template id="introAlert">
            <span slot="header">Character Sheet. 5e.</span>
            <p>An online character sheet for 5th edition D&amp;D, usable offline (in some browsers).</p>
            <p>Designed for modern browsers, if all else fails Chrome is your best bet and IE is your worst bet.</p>
            <p><strong>Warning:</strong> Character data is saved to your browser's local storage. This means it can be erased if you delete browser data and will not automatically transfer between browsers even on the same computer. Please Save and Backup often (or at least at the end of every gaming session)!</p>
            <p>This message will only appear until you save your first character.</p>
        </template>
        <template id="helpDialog">
            <span slot="header">Help</span>

            <h2>Most importantly</h2>
            <ul>
                <li>This app only saves data to your browsers' local storage. If your browser's data is deleted, your saved characters will be deleted. Use the backup options to save character data when you make changes.</li>
                <li>This app is designed for modern web browsers, it has been tested in Chrome (desktop and mobile), Firefox (desktop), and Safari (desktop and mobile). It is possible this will work in IE Edge too, I haven't tested it (if you try it send me any bugs).</li>
                <li>After you've loaded the app, it will work offline in Chrome, Firefox, and Safari (desktop) as well as Safari (iOS) and Chrome (Android). Chrome (iOS) does not seem to work offline, and I haven't tried any other browsers.</li>
            </ul>

            <h2>Actions</h2>

            <ul>
                <li><strong>Save</strong> This will save the current character to local storage. If the character already exists it will update.</li>
                <li><strong>Load</strong> This will show you a list of saved characters (if you have any). Clicking on a character's name will load that character. Note: You will lose any unsaved data if you load a character without saving the one currently displayed.</li>
                <li><strong>New Character</strong> This will load up a new/blank character sheet. Note: You will lose any unsaved data if you create a new character without saving the one currently displayed.</li>
                <li><strong>File Backup</strong> This will create data in the JSON format that can be loaded into this app in another browser/device. It will either:
                    <ul>
                        <li>Generate a download file with the currently viewed character's backup data.</li>
                        <li>Pop up the currently viewed character's backup data so it can be copied and pasted somewhere else.</li>
                    </ul>
                </li>
                <li><strong>Email Backup</strong> This will open your default email client and start a new message containing the currently viewed character's backup data as well as instructions on how to use that data.</li>
                <li><strong>Restore Backup</strong> This opens a form for uploading a file or pasting in character backup data to save that character in the current browser. If the character already exists they will be updated to match the restored data (so be careful).</li>
            </ul>

            <h2>Character Sheet</h2>

            <ul>
                <li>Click on data or empty areas to edit. Data is NOT automatically saved; you must hit the <strong>Save</strong> button (or use the keyboard shortcut).</li>
                <li>Ability, saving throw, and skill modifiers are all automatically calculated when the proficiency, ability, save, or skill fields are changed.</li>
                <li>All other fields are manually changed.</li>
                <li>Spell lists only appear if the corresponding spell slot is greater than 0.</li>
                <li>Press <em>enter</em> while editing any list field to add another empty field to the list. (Use <em>Shift+Enter</em> to add a new line.)</li>
            </ul>

            <h2>Keyboard Shortcuts</h2>
            <table>
                <thead><tr><th>Keys</th><th>Action</th></tr></thead>
                <tbody>
                    <tr><td><em>Ctrl+Shift+ArrowDown</em></td><td>Save current character</td></tr>
                    <tr><td><em>Ctrl+Shift+ArrowLeft</em></td><td>Switch Tabs</td></tr>
                    <tr><td><em>Ctrl+Shift+ArrowUp</em></td><td>Toggle Load Character menu (and focus on it).</td></tr>
                    <tr><td><em>Esc</em></td><td>Close modals/dialogs.</td></tr>
                    <tr><td><em>ArrowRight, ArrowLeft</em></td><td>Navigate the action toolbar at the top.</td></tr>
                </tbody>
            </table>
        </template>

        <template id="backupModal">
            <span slot="header">Backup Characters</span>
            <form id="form_backup_download" target="_self">
                <fieldset>
                    <legend tabindex="-1">Pick characters to download.</legend>
                    <ul class="character_downloads"></ul>
                </fieldset>
                <fieldset>
                    <legend>Pick a format</legend>
                    <ul>
                    <li><label><input type="radio" name="format" value="file" checked> File download</label></li>
                    <li><label><input type="radio" name="format" value="email"> Email data</label></li>
                </fieldset>
                <button type="submit">Download</button>
                <button type="button" class="close">Cancel</button>
            </form>
        </template>

        <template id="restoreModal">
            <span slot="header">Restore Characters</span>
            <form id="form_backup_restore" target="_self">
                <label for="files">Restore from file</label>
                <input type="file" id="files" name="files" />
                <p>or</p>
                <label for="backup_data">Paste the character backup data</label>
                <textarea id="backup_data" name="backup_data"></textarea>
                <button type="submit">Restore</button>
                <button type="button" class="close">Cancel</button>
            </form>
        </template>

        <template id="deleteModal">
            <span slot="header">Delete Characters</span>
            <p>This will delete locally stored characters. If you have saved characters remotely, use the sync modal to remove the remote copies.</p>
            <ul id="delete_list">
            </ul>
        </template>

        <template id="loadModal">
            <span slot="header">Load Character</span>
            <ul id="character_list">
            </ul>
        </template>

        <template id="authSignInModal">
            <span slot="header">Sign-in</span>
            <div>
                <p>By signing in, you can save data remotely, and then access your characters from any browser/device.</p>
                <p>Your auth credentials are saved for use with Google's Firebase Firestore. I get access to very little information about you, other than email and some other publicly available profile data.</p>
                <p><button type="button" id="googleSignIn">Sign in with Google</button></p>
            </div>
        </template>

        <template id="authSignOutModal">
            <span slot="header">You are signed in...</span>
            <div>
                <p>Sync data between the remote database and your local browser. If you are using multiple devices make sure to save and sync before switching between them. <strong>Don't forget to backup.</strong></p>
                <p><button type="button" id="syncData">Sync with Remote</button></p>
            </div>
            <hr/>
            <div class="mg-top">
                <p>By signing out you may lose any unsaved data.</p>
                <p><button type="button" id="signOut">Sign Out</button></p>
            </div>
        </template>

        <template id="syncModal">
            <span slot="header">Sync Characters with Remote</span>
            <div>
                <p><strong>WARNING:</strong> There is currently no merge conflict resolution on the syncing. You can either download or upload but both operations will overwrite data <em>NOT</em> merge it. (I still need to figure out how to handle that well.)</p>
                <p>If you are working with multiple devices/browsers, please be aware of this. Don't edit in both places without first saving and up/downloading.</p>
                <ul id="characterSyncList">
                </ul>
            </div>
        </template>

        <script type="module" src="./index.js"></script>
        <script nomodule>
            alert('Sorry, you must use a modern browser for this to code to work.');
        </script>
    </body>
</html>
